import{u as y,j as e}from"./app-13HG_1GY.js";import{C as w}from"./circle-alert-CnL9XqZw.js";import{T as _}from"./trash-2-C5-eo-9B.js";import{P as k}from"./plus-C93rPDiC.js";import{S}from"./save-ZK0MI-_h.js";import{X as N}from"./Layout-DRo6Tvgr.js";const F=({fee:a,onClose:u,bankAccounts:p=[]})=>{const l=a.beneficiaries&&a.beneficiaries.length>0?a.beneficiaries.map(t=>({...t,amount:Math.round(parseFloat(t.percentage)/100*a.raw_amount)})):[{account_name:"",account_number:"",bank_name:"",amount:""}],{data:d,setData:x,post:b,processing:j,errors:f}=y({beneficiaries:l}),g=()=>{x("beneficiaries",[...d.beneficiaries,{account_name:"",account_number:"",bank_name:"",amount:""}])},h=t=>{const o=[...d.beneficiaries];o.splice(t,1),x("beneficiaries",o)},v=(t,o,i)=>{const c=[...d.beneficiaries];{const C=parseFloat(i)||0;c[t].amount=i,c[t].percentage=a.raw_amount>0?(C/a.raw_amount*100).toFixed(2):0}x("beneficiaries",c)},n=(t,o)=>{const i=p.find(c=>c.id==o);if(i){const c=[...d.beneficiaries];c[t]={...c[t],bank_account_id:i.id,account_name:i.account_name,account_number:i.account_number,bank_name:i.bank_name,bank_code:i.bank_code},x("beneficiaries",c)}},r=d.beneficiaries.reduce((t,o)=>t+(parseFloat(o.amount)||0),0),s=Math.abs(r-a.raw_amount)<1,m=t=>{if(t.preventDefault(),!s){alert(`Total amount must equal ₦${a.raw_amount.toLocaleString()}`);return}b(`/fees/${a.id}/beneficiaries`,{onSuccess:()=>{u()}})};return e.jsx("div",{className:"modal-overlay",onClick:u,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),style:{background:"white",borderRadius:"12px",width:"90%",maxWidth:"800px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{className:"modal-header",style:{padding:"20px 24px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.25rem",color:"#1a1a1a"},children:"Split Beneficiaries"}),e.jsxs("p",{style:{margin:"4px 0 0",color:"#666",fontSize:"0.9rem"},children:["Total Fee Amount: ",e.jsxs("strong",{children:["₦",a.raw_amount.toLocaleString()]})]})]}),e.jsx("button",{onClick:u,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#999"},children:"×"})]}),e.jsxs("form",{onSubmit:m,style:{padding:"24px"},children:[!s&&e.jsxs("div",{style:{display:"flex",gap:"10px",padding:"12px",background:"#ffebee",borderRadius:"8px",color:"#c62828",marginBottom:"20px",fontSize:"0.9rem"},children:[e.jsx(w,{size:20}),e.jsxs("div",{children:[e.jsx("strong",{children:"Invalid Total Allocation"}),e.jsxs("p",{style:{margin:0},children:["Total split must equal ₦",a.raw_amount.toLocaleString(),". Current: ₦",r.toLocaleString()," (Diff: ₦",(a.raw_amount-r).toLocaleString(),")"]})]})]}),e.jsxs("div",{className:"beneficiaries-list",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 120px 40px",gap:"12px",paddingBottom:"8px",borderBottom:"1px solid #eee",marginBottom:"12px",fontWeight:"600",fontSize:"0.85rem",color:"#666"},children:[e.jsx("div",{children:"Account Name"}),e.jsx("div",{children:"Account Number"}),e.jsx("div",{children:"Bank Name"}),e.jsx("div",{children:"Amount (₦)"}),e.jsx("div",{})]}),d.beneficiaries.map((t,o)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 120px 40px",gap:"12px",marginBottom:"12px",alignItems:"start"},children:[e.jsxs("div",{style:{gridColumn:"1 / span 3",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},children:[p.length>0?e.jsxs("select",{onChange:i=>n(o,i.target.value),style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid #ddd",gridColumn:"span 3",marginBottom:"8px"},value:t.bank_account_id||"",children:[e.jsx("option",{value:"",children:"-- Select Bank Account --"}),p.map(i=>e.jsxs("option",{value:i.id,children:[i.bank_name," - ",i.account_name," (",i.account_number,")"]},i.id))]}):null,e.jsx("input",{type:"text",value:t.account_name,readOnly:!0,placeholder:"Account Name",style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid #eee",background:"#f9f9f9",color:"#666"}}),e.jsx("input",{type:"text",value:t.account_number,readOnly:!0,placeholder:"Account Number",style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid #eee",background:"#f9f9f9",color:"#666"}}),e.jsx("input",{type:"text",value:t.bank_name,readOnly:!0,placeholder:"Bank Name",style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid #eee",background:"#f9f9f9",color:"#666"}})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"number",value:t.amount,onChange:i=>v(o,"amount",i.target.value),placeholder:"0",required:!0,min:"0",max:a.raw_amount,style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid #ddd"}}),e.jsx("span",{style:{position:"absolute",right:"0",top:"42px",color:"#999",fontSize:"0.75rem",width:"100%",textAlign:"right"},children:t.percentage?`${parseFloat(t.percentage).toFixed(1)}%`:"0%"})]}),e.jsx("button",{type:"button",onClick:()=>h(o),style:{height:"40px",color:"#d32f2f",background:"#ffebee",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_,{size:18})})]},o))]}),e.jsxs("button",{type:"button",className:"add-row-btn",onClick:g,style:{marginTop:"20px",color:"#E91E63",fontWeight:"500",background:"transparent",border:"1px dashed #E91E63",padding:"10px",width:"100%",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(k,{size:18})," Add Another Account"]}),e.jsxs("div",{style:{marginTop:"24px",paddingTop:"20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",gap:"12px"},children:[e.jsx("button",{type:"button",onClick:u,style:{padding:"10px 20px",borderRadius:"6px",border:"1px solid #ddd",background:"white",color:"#666",cursor:"pointer",fontWeight:"500"},children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:j||!s,style:{padding:"10px 24px",borderRadius:"6px",border:"none",background:s?"#E91E63":"#ccc",color:"white",cursor:s?"pointer":"not-allowed",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(S,{size:18})," Save Splits"]})]})]})]})})},O=({fee:a,classes:u,onClose:p})=>{const{data:l,setData:d,post:x,processing:b,errors:j}=y({overrides:a.overrides||[]}),f=()=>{const n=l.overrides.map(s=>parseInt(s.class_id)),r=u.find(s=>!n.includes(s.id));if(!r){alert("All classes already have specific amounts set.");return}d("overrides",[...l.overrides,{class_id:r.id,amount:a.raw_amount,status:"active"}])},g=n=>{const r=[...l.overrides];r.splice(n,1),d("overrides",r)},h=(n,r,s)=>{const m=[...l.overrides];m[n]={...m[n],[r]:s},d("overrides",m)},v=n=>{n.preventDefault(),x(`/fees/${a.id}/overrides`,{onSuccess:()=>{p()}})};return e.jsx("div",{className:"override-modal-overlay",onClick:p,children:e.jsxs("div",{className:"override-modal-content",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"override-modal-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Class Specific Amounts"}),e.jsxs("p",{className:"subtitle",children:[a.title," (Default: ₦",a.raw_amount.toLocaleString(),")"]})]}),e.jsx("button",{className:"close-btn",onClick:p,children:e.jsx(N,{size:20})})]}),e.jsxs("form",{onSubmit:v,className:"override-form",children:[e.jsx("div",{className:"overrides-list",children:l.overrides.length===0?e.jsx("div",{className:"empty-overrides",children:e.jsx("p",{children:"No specific class amounts set. All classes pay the default amount."})}):e.jsxs("table",{className:"overrides-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Amount (₦)"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:l.overrides.map((n,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("select",{value:n.class_id,onChange:s=>h(r,"class_id",s.target.value),className:"override-select",children:u.map(s=>{const m=l.overrides.some((t,o)=>parseInt(t.class_id)===s.id&&o!==r);return e.jsx("option",{value:s.id,disabled:m,children:s.name},s.id)})})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:n.amount,onChange:s=>h(r,"amount",s.target.value),className:"override-input",placeholder:"0"})}),e.jsx("td",{children:e.jsxs("select",{value:n.status,onChange:s=>h(r,"status",s.target.value),className:"override-select status-select",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>g(r),children:e.jsx(_,{size:16})})})]},r))})]})}),e.jsxs("button",{type:"button",className:"add-override-btn",onClick:f,children:[e.jsx(k,{size:16})," Add Class Amount"]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"save-btn",disabled:b,children:b?"Saving...":"Save Changes"})]})]})]})})};export{F,O as a};
