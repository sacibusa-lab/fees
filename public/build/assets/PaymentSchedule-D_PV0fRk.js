import{r as n,j as e,H as K,b as P}from"./app-9_oLEb-g.js";import{L as Q,c as g,S as U,B as W,F as M}from"./Layout-CVgtbi8l.js";import{D as X}from"./download-DaMS1mGm.js";import{c as Z}from"./createLucideIcon-D3VZeyuY.js";const ee=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],se=Z("printer",ee),ie=({sessions:F=[],classes:B=[],subClasses:$=[],fees:z=[]})=>{const[r,E]=n.useState(""),[o,L]=n.useState(""),[m,I]=n.useState(""),[u,w]=n.useState(""),[x,R]=n.useState("all"),[p,A]=n.useState(!1),[a,h]=n.useState(null),H=$,k=async()=>{if(!r||!o){alert("Please select both Academic Year and Term");return}A(!0);try{const s=await P.get("/payments/schedule/preview",{params:{session_id:r,term:o,class_id:m,sub_class_id:u,fee_title:x}});h(s.data)}catch(s){console.error("Error fetching preview:",s),alert("Failed to fetch schedule preview. Please try again.")}finally{A(!1)}},[c,j]=n.useState([]),[O,S]=n.useState(!1),[t,N]=n.useState({amount:"",type:"subtract",description:""}),[q,C]=n.useState(!1),[l,v]=n.useState({mode:"full",amount:"",description:""}),[b,y]=n.useState(!1),T=s=>{const d=Number(s);j(i=>i.includes(d)?i.filter(_=>_!==d):[...i,d])},Y=()=>{c.length===a.notices.length?j([]):j(a.notices.map(s=>Number(s.student.id)))},G=async()=>{if(t.amount){y(!0);try{await P.post("/payments/schedule/bulk-modify",{student_ids:c,amount:t.amount,type:t.type,description:t.description,session_id:r,term:o}),S(!1),N({amount:"",type:"subtract",description:""}),j([]),k(),alert("Bulk amounts modified successfully")}catch(s){console.error("Bulk modify error:",s),alert("Failed to modify amounts")}finally{y(!1)}}},V=()=>{C(!0),v({mode:"full",amount:"",description:""})},J=async()=>{if(!(l.mode==="partial"&&!l.amount)){y(!0);try{await P.post("/payments/schedule/bulk-mark-paid",{student_ids:c,session_id:r,term:o,fee_title:x,payment_mode:l.mode,amount:l.amount,description:l.description}),C(!1),j([]),k(),alert("Payments recorded successfully")}catch(s){console.error("Bulk payment error:",s),alert("Failed to record payments")}finally{y(!1)}}},D=()=>{if(!r||!o)return;let s=`/payments/schedule/download?session_id=${r}&term=${o}`;m&&(s+=`&class_id=${m}`),u&&(s+=`&sub_class_id=${u}`),s+=`&fee_title=${x}`,window.open(s,"_blank")},f=(s="all")=>{if(!r||!o)return;let d=`/payments/schedule/export?session_id=${r}&term=${o}&status=${s}`;m&&(d+=`&class_id=${m}`),u&&(d+=`&sub_class_id=${u}`),d+=`&fee_title=${x}`,window.open(d,"_blank")};return e.jsxs(Q,{children:[e.jsx(K,{title:"Payment Schedule"}),e.jsxs("div",{className:"payment-schedule-container",children:[e.jsxs("div",{className:"payment-schedule-header",children:[e.jsx("h1",{className:"page-heading",children:"Payment Schedule"}),e.jsx("div",{className:"header-actions",children:a&&e.jsxs("div",{className:"export-dropdown",children:[e.jsxs("button",{className:"export-main-btn",children:[e.jsx(X,{size:18}),"Export List"]}),e.jsxs("div",{className:"export-menu",children:[e.jsx("button",{onClick:()=>f("all"),children:"All Students"}),e.jsx("button",{onClick:()=>f("paid"),children:"Paid Only"}),e.jsx("button",{onClick:()=>f("pending"),children:"Pending Only"}),e.jsx("button",{onClick:()=>f("partial"),children:"Part Payment"})]})]})})]}),e.jsx("div",{className:"schedule-filter-card card",children:e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:["Academic Year ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{value:r,onChange:s=>{E(s.target.value),h(null)},className:"schedule-select",children:[e.jsx("option",{value:"",children:"Select Session"}),F.map(s=>e.jsx("option",{value:s.id,children:s.name||s.year},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:["Term ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{value:o,onChange:s=>{L(s.target.value),h(null)},className:"schedule-select",children:[e.jsx("option",{value:"",children:"Select Term"}),e.jsx("option",{value:"1st Term",children:"1st Term"}),e.jsx("option",{value:"2nd Term",children:"2nd Term"}),e.jsx("option",{value:"3rd Term",children:"3rd Term"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Class"}),e.jsxs("select",{value:m,onChange:s=>{I(s.target.value),w(""),h(null)},className:"schedule-select",children:[e.jsx("option",{value:"",children:"All Classes"}),B.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Subclass"}),e.jsxs("select",{value:u,onChange:s=>{w(s.target.value),h(null)},className:"schedule-select",disabled:!m,children:[e.jsx("option",{value:"",children:"All Subclasses"}),H.filter(s=>!m||s.class_id==m||!s.class_id).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Payment Type"}),e.jsxs("select",{value:x,onChange:s=>{R(s.target.value),h(null)},className:"schedule-select",children:[e.jsx("option",{value:"all",children:"All Payments"}),z.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"filter-action",children:e.jsx("button",{className:"schedule-search-btn",onClick:k,disabled:p,children:p?e.jsx(g,{className:"animate-spin",size:20}):e.jsx(U,{size:20})})})]})}),p&&e.jsxs("div",{className:"preview-loading",children:[e.jsx(g,{className:"animate-spin",size:48,color:"var(--primary)"}),e.jsx("p",{children:"Generating schedule preview..."})]}),a&&!p&&e.jsxs("div",{className:"schedule-results",children:[e.jsxs("div",{className:"selection-info-bar",children:[e.jsxs("div",{className:"selection-stats",children:[e.jsx("input",{type:"checkbox",checked:c.length===a.notices.length&&a.notices.length>0,onChange:Y,className:"bulk-checkbox"}),e.jsxs("span",{children:[c.length," students selected"]})]}),c.length>0&&e.jsxs("div",{className:"bulk-actions",children:[e.jsx("button",{className:"bulk-modify-btn",onClick:()=>S(!0),children:"Modify Amount"}),e.jsx("button",{className:"bulk-paid-btn",onClick:V,children:"Mark as Paid"})]})]}),e.jsx("div",{className:"preview-grid",children:a.notices.map((s,d)=>e.jsxs("div",{className:`notice-preview-card ${c.includes(Number(s.student.id))?"selected":""}`,onClick:()=>T(s.student.id),children:[e.jsx("div",{className:"selection-handler",children:e.jsx("input",{type:"checkbox",checked:c.includes(Number(s.student.id)),onChange:i=>{i.stopPropagation(),T(s.student.id)},className:"student-checkbox"})}),e.jsxs("div",{className:"notice-card-header",children:[e.jsxs("div",{className:"institution-info",children:[e.jsx("div",{className:"inst-logo",children:a.institution.logo?e.jsx("img",{src:a.institution.logo,alt:"Logo"}):e.jsx(W,{size:24})}),e.jsxs("div",{className:"inst-details",children:[e.jsx("h3",{children:a.institution.name}),e.jsxs("p",{children:[a.term," School Fees"]})]})]}),e.jsx("div",{className:"notice-badge",children:"Payment Notice"})]}),e.jsxs("div",{className:"student-info-row",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Name"}),e.jsx("span",{children:s.student.name})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Reg No"}),e.jsx("span",{children:s.student.admission_number})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Class"}),e.jsx("span",{children:s.student.school_class?.name})]})]}),e.jsxs("div",{className:"account-info-box",children:[e.jsxs("div",{className:"account-item",children:[e.jsx("label",{children:"Account Number"}),e.jsx("span",{children:s.student.virtual_account?.account_number||"N/A"})]}),e.jsxs("div",{className:"account-item",children:[e.jsx("label",{children:"Bank Name"}),e.jsx("span",{children:s.student.virtual_account?.bank_name||"N/A"})]})]}),e.jsxs("table",{className:"preview-fees-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fee Description"}),e.jsx("th",{children:"Amount"})]})}),e.jsx("tbody",{children:s.fees.map((i,_)=>e.jsxs("tr",{className:i.is_adjustment?"fee-adjustment-row":"",children:[e.jsxs("td",{children:[i.title,i.is_adjustment&&e.jsx("span",{className:"adj-tag",children:"Adj"})]}),e.jsxs("td",{className:i.amount<0?"negative-amount":"",children:[i.amount<0?"-":"","â‚¦",Math.abs(parseFloat(i.amount)).toLocaleString()]})]},_))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Total Due"}),e.jsxs("th",{children:["â‚¦",parseFloat(s.total_due).toLocaleString()]})]})})]})]},d))}),O&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content bulk-modify-modal",children:[e.jsxs("h2",{children:["Modify Amount for ",c.length," Students"]}),e.jsx("p",{className:"modal-subtitle",children:"Add extra charges or apply discounts in bulk."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Action Type"}),e.jsxs("div",{className:"type-toggle",children:[e.jsx("button",{className:t.type==="add"?"active add":"",onClick:()=>N({...t,type:"add"}),children:"Add (Charge)"}),e.jsx("button",{className:t.type==="subtract"?"active subtract":"",onClick:()=>N({...t,type:"subtract"}),children:"Subtract (Discount)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount (â‚¦)"}),e.jsx("input",{type:"number",value:t.amount,onChange:s=>N({...t,amount:s.target.value}),placeholder:"Enter amount",className:"modal-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description (Optional)"}),e.jsx("input",{type:"text",value:t.description,onChange:s=>N({...t,description:s.target.value}),placeholder:"e.g. Bus Fee, Late Payment Discount",className:"modal-input"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>S(!1),children:"Cancel"}),e.jsx("button",{className:"submit-btn",onClick:G,disabled:!t.amount||b,children:b?e.jsx(g,{className:"animate-spin",size:20}):"Apply Adjustments"})]})]})}),q&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content bulk-modify-modal",children:[e.jsxs("h2",{children:["Record Payment for ",c.length," Students"]}),e.jsx("p",{className:"modal-subtitle",children:"Mark selected students as paid manually."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Mode"}),e.jsxs("div",{className:"type-toggle",children:[e.jsx("button",{className:l.mode==="full"?"active add":"",onClick:()=>v({...l,mode:"full"}),children:"Full Payment"}),e.jsx("button",{className:l.mode==="partial"?"active partial":"",onClick:()=>v({...l,mode:"partial"}),children:"Partial / Custom"})]})]}),l.mode==="partial"&&e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Amount to Pay (â‚¦) ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"number",value:l.amount,onChange:s=>v({...l,amount:s.target.value}),placeholder:"Enter amount to record for EACH student",className:"modal-input"}),e.jsxs("p",{className:"field-hint",children:["This amount will be recorded for ",e.jsx("strong",{children:"each"})," selected student."]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description (Optional)"}),e.jsx("input",{type:"text",value:l.description,onChange:s=>v({...l,description:s.target.value}),placeholder:"e.g. Cash Payment, Bank Transfer",className:"modal-input"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>C(!1),children:"Cancel"}),e.jsx("button",{className:"submit-btn",onClick:J,disabled:l.mode==="partial"&&!l.amount||b,children:b?e.jsx(g,{className:"animate-spin",size:20}):"Record Payments"})]})]})}),a.notices.length===0&&e.jsxs("div",{className:"empty-results card",children:[e.jsx(M,{size:48,color:"var(--text-secondary)"}),e.jsx("h3",{children:"No students found"}),e.jsx("p",{children:"Try adjusting your filters to find students for this period."})]}),a.notices.length>0&&e.jsxs("div",{className:"schedule-footer-actions card",children:[e.jsxs("div",{className:"actions-info",children:[e.jsx("h3",{children:"Ready to Export"}),e.jsxs("p",{children:[a.notices.length," payment notices generated for ",a.session_name," - ",a.term]})]}),e.jsxs("div",{className:"actions-buttons",children:[e.jsxs("button",{className:"download-pdf-btn",onClick:D,children:[e.jsx(M,{size:20}),"Download PDF"]}),e.jsxs("button",{className:"print-btn",onClick:D,children:[e.jsx(se,{size:20}),"Print Notices"]})]})]})]}),!a&&!p&&e.jsx("div",{className:"payment-schedule-card card",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“…"}),e.jsx("h2",{children:"Generate Payment Notices"}),e.jsx("p",{children:"Select an Academic Year and Term above to generate and download payment schedules for all students."})]})})]})]})};export{ie as default};
