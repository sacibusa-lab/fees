import{r as c,j as e,b as A,d as D,H as $,a as z}from"./app-CiNM6r81.js";import{d as F,L as I}from"./Layout-UVH52YpB.js";/* empty css                       */import{A as R}from"./arrow-left-CKf13L_0.js";import{c as f}from"./createLucideIcon-9gt5Qjzr.js";import{D as O}from"./download-STJn-zhn.js";import{W as M}from"./wallet-BubqnV4_.js";import{C as q}from"./circle-check-big-B2MoGiBl.js";import{C as B}from"./circle-alert-BGGbHLbn.js";const U=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],E=f("chevron-right",U);const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],W=f("circle-plus",H);const G=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],V=f("grid-3x3",G);const X=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],J=f("trending-up",X);const K=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Q=f("user-check",K),Y=({isOpen:d,onClose:r,sessions:n,currentSession:i,currentTerm:h,onApply:o})=>{if(!d)return null;const[p,j]=c.useState(i),[m,v]=c.useState(h||"1st"),x=["1st","2nd","3rd"],N=()=>{o(p,m),r()};return e.jsx("div",{className:"period-modal-overlay",onClick:r,children:e.jsxs("div",{className:"period-modal-content",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"period-modal-header",children:e.jsx("h3",{children:"Select academic period"})}),e.jsxs("div",{className:"period-selection-container",children:[e.jsx("div",{className:"period-column",children:n.map(l=>e.jsx("button",{className:`period-option-btn ${p===l.name?"active":""}`,onClick:()=>j(l.name),children:l.name},l.id||l.name))}),e.jsx("div",{className:"period-column",children:x.map(l=>e.jsx("button",{className:`period-option-btn ${m===l?"active":""}`,onClick:()=>v(l),children:l},l))})]}),e.jsxs("div",{className:"period-modal-footer",children:[e.jsx("button",{className:"period-dismiss-btn",onClick:r,children:"Dismiss"}),e.jsx("button",{className:"period-apply-btn",onClick:N,children:"Apply"})]})]})})},Z=({isOpen:d,onClose:r,classData:n,feeId:i})=>{console.log("ClassPaymentDetailModal Render:",{isOpen:d,classData:n,feeId:i});const[h,o]=c.useState(!0),[p,j]=c.useState([]),[m,v]=c.useState(""),[x,N]=c.useState(""),[l,C]=c.useState("grid"),[u,S]=c.useState({className:"",feeTitle:""});c.useEffect(()=>{d&&n?.id&&i&&k()},[d,n,i]);const k=async()=>{o(!0);try{const a=await A.get(`/api/payments/class-detail/${n.id}?fee_id=${i}`);j(a.data.students||[]),S({className:a.data.class_name||"",feeTitle:a.data.fee_title||""})}catch(a){console.error("Error fetching class details:",a),j([])}finally{o(!1)}};if(!d)return null;const g=p.filter(a=>{const _=a.name||"",T=a.reg_no||"",s=_.toLowerCase().includes(m.toLowerCase())||T.toLowerCase().includes(m.toLowerCase()),t=x?a.sub_class===x:!0;return s&&t}),y=[...new Set(p.map(a=>a.sub_class).filter(Boolean))],w=e.jsx("div",{className:"modal-overlay",onClick:r,style:{zIndex:9999},children:e.jsxs("div",{className:"modal-content class-payment-detail-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"detail-modal-header",children:[e.jsxs("div",{className:"header-top-row",children:[e.jsx("h2",{className:"class-title",children:u.className||n?.title||"Class Detail"}),u.feeTitle&&e.jsx("span",{className:"header-fee-badge",children:u.feeTitle})]}),e.jsxs("div",{className:"header-actions-row",children:[e.jsx("button",{className:"back-btn",onClick:r,title:"Go Back",children:e.jsx(R,{size:20})}),e.jsxs("div",{className:"main-actions-group",children:[e.jsxs("button",{className:"action-outline-btn schedule",children:[e.jsx(F,{size:16}),"Schedule"]}),e.jsxs("button",{className:"action-outline-btn exemption",children:[e.jsx(Q,{size:16}),"Exemption"]}),e.jsxs("button",{className:"action-outline-btn export",children:[e.jsx(O,{size:16}),"Export"]}),e.jsx("button",{className:"action-outline-btn bulk-modify",children:"Modify Bulk Amount"})]})]})]}),e.jsxs("div",{className:"detail-modal-body",children:[e.jsxs("div",{className:"modal-filters-row",children:[e.jsxs("select",{className:"modal-filter-select",value:x,onChange:a=>N(a.target.value),children:[e.jsx("option",{value:"",children:"Filter by subclass"}),y.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("div",{className:"modal-search-wrapper",children:e.jsx("input",{type:"text",className:"modal-search-input",placeholder:"Search by name or reg number",value:m,onChange:a=>v(a.target.value)})})]}),e.jsxs("div",{className:"selection-info-bar",children:[e.jsx("span",{className:"selection-count",children:"0 Selected"}),e.jsxs("button",{className:"switch-view-btn",onClick:()=>C(l==="grid"?"list":"grid"),children:[e.jsx("span",{children:"switch view"}),e.jsx(V,{size:18})]})]}),h?e.jsxs("div",{className:"modal-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading student data..."})]}):e.jsxs("div",{className:`student-status-grid ${l}`,children:[g.map(a=>l==="grid"?e.jsxs("div",{className:"student-status-card",children:[e.jsx("div",{className:"status-icon-wrapper",children:e.jsxs("svg",{viewBox:"0 0 24 24",width:"32",height:"32",stroke:"currentColor",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",className:`status-icon ${a.status}`,children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsx("span",{className:"card-student-name",children:a.name}),e.jsx("span",{className:"card-reg-no",children:a.reg_no})]},a.id):e.jsxs("div",{className:`status-card-dense ${a.status||"pending"}`,children:[e.jsx("div",{className:"dense-reg-no",children:a.reg_no||"N/A"}),e.jsx("div",{className:"dense-student-name",children:a.name}),e.jsxs("div",{className:"dense-info-row",children:[e.jsx("span",{className:"label",children:"Discount:"}),e.jsx("span",{className:"value",children:a.discount||"None"})]}),e.jsxs("div",{className:"dense-info-row",children:[e.jsx("span",{className:"label",children:"Status:"}),e.jsx("span",{className:"value capitalize",children:a.status||"Pending"})]}),e.jsxs("div",{className:"dense-info-row",children:[e.jsx("span",{className:"label",children:"Received:"}),e.jsxs("span",{className:"value",children:["₦",(a.received_amount||0).toLocaleString()]})]})]},a.id)),g.length===0&&e.jsx("div",{className:"no-results-msg",style:{gridColumn:"1/-1",padding:"2rem",textAlign:"center",color:"var(--text-secondary)"},children:"No students found matching your filters."})]})]}),e.jsx("div",{className:"detail-modal-footer",children:e.jsx("button",{className:"close-action-btn",onClick:r,children:"Close"})})]})});return D.createPortal(w,document.body)},oe=({initialExpandedStats:d=[],initialPaymentBreakdown:r=[],sessions:n=[],fees:i=[],filters:h={}})=>{const[o,p]=c.useState(h.fee_id||i[0]?.id||"all"),[j,m]=c.useState(null),[v,x]=c.useState(!1),N=n.find(s=>s.id==h.session_id)?.name||n.find(s=>s.is_current)?.name||"2023/2024",[l,C]=c.useState(N),[u,S]=c.useState(h.term||"1st Term"),[k,g]=c.useState(!1),y=s=>{const t={fee_id:s.fee_id||o,session_id:s.session_id||h.session_id,term:s.term||u};z.get("/payments/overview",t,{preserveState:!0,replace:!0})},w=s=>{const t=s.target.value;p(t),y({fee_id:t})},a=(s,t)=>{const b=`${t} Term`,L=n.find(P=>P.name===s);C(s),S(b),y({session_id:L?.id,term:b})},_=s=>{let t=o;t==="all"&&i.length>0&&(t=i[0].id),t&&t!=="all"&&(m(s),x(!0))},T=s=>{switch(s.toUpperCase()){case"RECEIVED":return{icon:e.jsx(J,{size:20}),color:"blue"};case"EXPECTED":return{icon:e.jsx(M,{size:20}),color:"purple"};case"DEBT":return{icon:e.jsx(B,{size:20}),color:"red"};case"DISCOUNT APPLIED":return{icon:e.jsx(q,{size:20}),color:"green"};case"EXTRA APPLIED":return{icon:e.jsx(W,{size:20}),color:"orange"};default:return{icon:e.jsx(M,{size:20}),color:"blue"}}};return e.jsxs(I,{children:[e.jsx($,{title:"Payments Overview"}),e.jsxs("div",{className:"payments-overview",children:[e.jsxs("div",{className:"expanded-view-content",children:[e.jsxs("div",{className:"filter-bar",children:[e.jsx("h3",{className:"section-title",children:"Payments Overview"}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("select",{className:"filter-select",value:o,onChange:w,children:[e.jsx("option",{value:"all",children:"All Fees"}),i.length>0&&i.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]}),e.jsxs("button",{className:"filter-select period-trigger-btn",onClick:()=>g(!0),style:{textAlign:"left",minWidth:"200px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[l," - ",u]}),e.jsx(E,{size:14,style:{transform:"rotate(90deg)"}})]})]})]}),e.jsx(Y,{isOpen:k,onClose:()=>g(!1),sessions:n.length>0?n:[{name:"2023/2024"},{name:"2024/2025"}],currentSession:l,currentTerm:u.replace(" Term",""),onApply:a}),e.jsx("div",{className:"metrics-grid",children:d.map((s,t)=>{const b=T(s.label);return e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:`metric-icon-box ${b.color}`,children:b.icon}),e.jsx("div",{className:"metric-header",children:e.jsx("span",{className:"metric-label",children:s.label})}),e.jsxs("div",{className:"metric-body",children:[e.jsx("span",{className:"metric-amount",children:s.amount}),e.jsxs("span",{className:"metric-count",children:[s.count," students"]})]})]},t)})}),e.jsx("div",{className:"breakdown-table-section",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"stats-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S/N"}),e.jsx("th",{children:"Class Name"}),e.jsx("th",{children:"Flat Fee"}),e.jsx("th",{children:"Expected"}),e.jsx("th",{children:"Total Received"}),e.jsx("th",{children:"Debt"}),e.jsx("th",{children:"Collection Progress"}),e.jsx("th",{children:"Extra/Disc"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[r.map((s,t)=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>_(s),children:[e.jsx("td",{children:t+1}),e.jsx("td",{className:"title-cell",children:s.title}),e.jsxs("td",{children:["₦",s.flatAmount.toLocaleString()]}),e.jsx("td",{children:e.jsxs("div",{className:"amount-col",children:[e.jsxs("span",{className:"amount-val",children:["₦",s.expected.split(" (")[0]]}),e.jsxs("span",{className:"count-val",children:[s.expected.split(" (")[1]?.replace(")","")||0," students"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"amount-col",children:[e.jsxs("span",{className:"amount-val",children:["₦",s.totalReceived.split(" (")[0]]}),e.jsxs("span",{className:"count-val",children:[s.totalReceived.split(" (")[1]?.replace(")","")||0," paid"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"amount-col",children:[e.jsxs("span",{className:"amount-val",children:["₦",s.debt.split(" (")[0]]}),e.jsxs("span",{className:"count-val",children:[s.debt.split(" (")[1]?.replace(")","")||0," pending"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-track",children:e.jsx("div",{className:"progress-fill",style:{width:`${s.progress}%`,backgroundColor:s.progress>=100?"#16a34a":s.progress>50?"#7c3aed":"#f59e0b"}})}),e.jsxs("span",{className:"progress-text",children:[s.progress,"%"]})]})}),e.jsx("td",{children:e.jsx("div",{className:"amount-col",children:e.jsx("span",{className:"amount-val",style:{color:s.extraCharge>0?"#ea580c":"#0f172a"},children:s.extraCharge>0?`+₦${s.extraCharge.toLocaleString()}`:s.discount>0?`-₦${s.discount.toLocaleString()}`:"—"})})}),e.jsx("td",{children:e.jsx("button",{className:"row-action-btn",children:e.jsx(E,{size:18})})})]},s.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"9",style:{textAlign:"center",padding:"3rem",color:"#64748b"},children:"No breakdown data found for this selection."})})]})]})})})]}),e.jsx(Z,{isOpen:v,onClose:()=>x(!1),classData:j,feeId:o==="all"?i[0]?.id:o})]})]})};export{oe as default};
